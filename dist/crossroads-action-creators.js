"use strict";var Crossroads=require("crossroads-js");module.exports=function(t){var n=new Crossroads({apiKey:t.apiKey,host:t.host,port:t.port,tokenExpiryHandler:function(r){return fetch(crossroadsAccountsObject.accountsEndpoints.refresh,{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:n.accessToken})}).then(function(e){return e.json()}).then(function(e){var s=e.accounts[0];n.dispatch(c(s));var o=r.options;return o.headers.Authorization="Basic "+new Buffer(t.apiKey+":"+n.accessToken).toString("base64"),n.call(o,r.body)})}});function e(){return{type:"requestAccessToken"}}function c(e){return!0===e.errors||"yes"===e.errors?{type:"errorReceiveAccessToken",errors:e.errors,errorMessage:e.errorMessage}:(n.updateAccessToken(e.accessToken),{type:"receiveAccessToken",accessToken:e.accessToken,loginURI:e.loginURI})}function s(){return{type:"requestLogout"}}this.crossroads=n,this.requestAccessToken=e,this.fetchAccessToken=function(){return function(e){return(n.dispatch=e)({type:"requestAccessToken"}),e(c(crossroadsAccounts[0]))}},this.receiveAccessToken=c,this.requestLogout=s,this.fetchLogout=function(){return function(s){return s({type:"requestLogout"}),fetch(crossroadsAccountsObject.accountsEndpoints.destroy,{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:n.accessToken})}).then(function(e){return e.json()}).then(function(e){return s(c(e))})}}};